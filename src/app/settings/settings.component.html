<svg (click)="goBack()" class="arrow" fill="currentColor" viewBox="0 0 24 24">
  <path
    d="M2,12A10,10 0 0,1 12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12M18,11H10L13.5,7.5L12.08,6.08L6.16,12L12.08,17.92L13.5,16.5L10,13H18V11Z"
  />
</svg>
<div class="container px-5">
  <h2 class="mt-4 mb-4 text-center">Settings</h2>
  <ul class="nav nav-tabs mb-4">
    <li class="nav-item">
      <a
        class="nav-link"
        [class.active]="activeTab === 'general'"
        (click)="activeTab = 'general'"
        role="button"
        >General</a
      >
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        [class.active]="activeTab === 'filters'"
        (click)="activeTab = 'filters'"
        role="button"
        >Content Filters</a
      >
    </li>
  </ul>

  <!-- GENERAL TAB -->
  <div *ngIf="activeTab === 'general'">
    <div class="row align-items-center">
      <div class="col-4">
        <label [ngbTooltip]="'Where recorded livestreams will be saved'">Recording path</label>
      </div>
      <div class="col">
        <div class="d-flex align-items-center">
          <span class="selectable" *ngIf="!settings.recording_path" id="default-path"
            >~/Home/Videos</span
          >
          <span class="selectable" *ngIf="settings.recording_path">{{
            settings.recording_path
          }}</span>
          <button
            (click)="selectFolder()"
            class="btn btn-primary btn-sm ms-4 d-inline-flex align-items-center"
          >
            <span>Change</span>
            <svg fill="currentColor" class="ms-2 folder" viewBox="0 0 24 24">
              <path
                d="M19,20H4C2.89,20 2,19.1 2,18V6C2,4.89 2.89,4 4,4H10L12,6H19A2,2 0 0,1 21,8H21L4,8V18L6.14,10H23.21L20.93,18.5C20.7,19.37 19.92,20 19,20Z"
              />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- ... (Original Settings Content) ... -->
    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span
          [ngbTooltip]="
            'Launch parameters applied to all channels. Leave as-is if you don\'t know what this is'
          "
          >Global MPV Parameters</span
        >
      </div>
      <div class="col">
        <textarea
          #mpvParams
          id="mpvParams"
          [(ngModel)]="settings.mpv_params"
          placeholder="mpv params like: --hwdec auto. Don't touch this unless you know what you're doing!"
          class="form-control"
        ></textarea>
      </div>
    </div>

    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span id="label-default-view">Default view</span>
      </div>
      <div class="col">
        <select
          (ngModelChange)="updateSettings()"
          [(ngModel)]="settings.default_view"
          class="form-control"
          aria-labelledby="label-default-view"
          title="Default view"
        >
          <option [ngValue]="viewModeEnum.All">All</option>
          <option [ngValue]="viewModeEnum.Categories">Categories</option>
          <option [ngValue]="viewModeEnum.Favorites">Favorites</option>
        </select>
      </div>
    </div>

    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span id="label-default-sort">Default sort</span>
      </div>
      <div class="col">
        <select
          (ngModelChange)="updateSettings()"
          [(ngModel)]="settings.default_sort"
          class="form-control"
          aria-labelledby="label-default-sort"
          title="Default sort"
        >
          <ng-container *ngFor="let sort of sortTypes">
            <option [ngValue]="sort">{{ _getSortTypeText(sort) }}</option>
          </ng-container>
        </select>
      </div>
    </div>

    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span id="label-volume">Volume on start</span>
      </div>
      <div class="col d-inline-flex">
        <input
          type="range"
          step="1"
          class="form-range volume-range"
          min="0"
          max="100"
          [(ngModel)]="settings.volume"
          (ngModelChange)="updateSettings()"
          aria-labelledby="label-volume"
          title="Volume on start"
        />
        <span class="text-end flex-grow-0-5">{{ settings.volume }}</span>
      </div>
    </div>

    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span id="label-restream-port">Re-stream port</span>
      </div>
      <div class="col">
        <input
          class="form-control w-10rem"
          type="number"
          [(ngModel)]="settings.restream_port"
          aria-labelledby="label-restream-port"
          title="Re-stream port"
        />
      </div>
    </div>

    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span id="label-zoom">UI Zoom</span>
      </div>
      <div class="col">
        <div class="input-group w-10rem">
          <input
            class="form-control"
            step="10"
            min="10"
            max="1000"
            type="number"
            [(ngModel)]="settings.zoom"
            aria-labelledby="label-zoom"
            title="UI Zoom"
          />
          <span class="input-group-text">%</span>
        </div>
      </div>
    </div>

    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span
          id="label-stream-caching"
          [ngbTooltip]="
            'Depending on your provider/internet connection, using no caching would give you a lower latency and a more stable experience'
          "
          >Use stream caching</span
        >
      </div>
      <div class="col">
        <div class="form-check form-switch">
          <input
            [(ngModel)]="settings.use_stream_caching"
            (ngModelChange)="updateSettings()"
            class="form-check-input"
            type="checkbox"
            aria-labelledby="label-stream-caching"
            title="Use stream caching"
          />
        </div>
      </div>
    </div>

    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span
          id="label-hwdec"
          [ngbTooltip]="
            'Uses your gpu instead of your cpu to decode livestreams and movies. Concretely, this option adds hwdec=auto to the mpv config'
          "
          >Enable hardware acceleration</span
        >
      </div>
      <div class="col">
        <div class="form-check form-switch">
          <input
            [(ngModel)]="settings.enable_hwdec"
            (ngModelChange)="updateSettings()"
            class="form-check-input"
            type="checkbox"
            aria-labelledby="label-hwdec"
            title="Enable hardware acceleration"
          />
        </div>
      </div>
    </div>

    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span
          id="label-gpu"
          [ngbTooltip]="
            'Applies modern hardware settings for mpv. Concretely adds --vo=gpu-next --gpu-api=vulkan to the mpv config.'
          "
          >Use modern hardware player optimizations (HDR, gpu playback, etc)</span
        >
      </div>
      <div class="col">
        <div class="form-check form-switch">
          <input
            [(ngModel)]="settings.enable_gpu"
            (ngModelChange)="updateSettings()"
            class="form-check-input"
            type="checkbox"
            aria-labelledby="label-gpu"
            title="Use modern hardware player optimizations"
          />
        </div>
      </div>
    </div>

    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span id="label-single-column">Single column layout</span>
      </div>
      <div class="col">
        <div class="form-check form-switch">
          <input
            [(ngModel)]="settings.use_single_column"
            (ngModelChange)="updateSettings()"
            class="form-check-input"
            type="checkbox"
            aria-labelledby="label-single-column"
            title="Single column layout"
          />
        </div>
      </div>
    </div>

    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span id="label-max-text-lines">Text lines per tile</span>
      </div>
      <div class="col">
        <select
          (ngModelChange)="updateSettings()"
          [(ngModel)]="settings.max_text_lines"
          class="form-control"
          aria-labelledby="label-max-text-lines"
          title="Text lines per tile"
        >
          <option [ngValue]="undefined">Default (2 lines)</option>
          <option [ngValue]="2">2 lines</option>
          <option [ngValue]="3">3 lines</option>
        </select>
      </div>
    </div>

    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span
          id="label-compact-mode"
          [ngbTooltip]="'Reduces padding and tile size to fit more content on screen'"
        >
          Compact tile mode
        </span>
      </div>
      <div class="col">
        <div class="form-check form-switch">
          <input
            [(ngModel)]="settings.compact_mode"
            (ngModelChange)="updateSettings()"
            class="form-check-input"
            type="checkbox"
            aria-labelledby="label-compact-mode"
            title="Compact tile mode"
          />
        </div>
      </div>
    </div>

    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span
          id="label-always-ask-save"
          [ngbTooltip]="
            'Opens the file dialog for all downloads and recordings. Overrides recording path. '
          "
          >Always ask where to save downloads</span
        >
      </div>
      <div class="col">
        <div class="form-check form-switch">
          <input
            [(ngModel)]="settings.always_ask_save"
            (ngModelChange)="this.updateSettings()"
            class="form-check-input"
            type="checkbox"
            aria-labelledby="label-always-ask-save"
            title="Always ask where to save downloads"
          />
        </div>
      </div>
    </div>

    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span id="label-refresh-on-start">Refresh all sources on start</span>
      </div>
      <div class="col">
        <div class="form-check form-switch">
          <input
            [(ngModel)]="settings.refresh_on_start"
            (ngModelChange)="updateSettings()"
            class="form-check-input"
            type="checkbox"
            aria-labelledby="label-refresh-on-start"
            title="Refresh all sources on start"
          />
        </div>
      </div>
    </div>

    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span
          id="label-refresh-interval"
          [ngbTooltip]="'Automatically refresh playlists at this interval'"
        >
          Playlist Refresh Interval
        </span>
      </div>
      <div class="col">
        <select
          (ngModelChange)="updateSettings()"
          [(ngModel)]="settings.refresh_interval"
          class="form-control"
          aria-labelledby="label-refresh-interval"
          title="Playlist Refresh Interval"
        >
          <ng-container *ngFor="let interval of refreshIntervals">
            <option [ngValue]="interval.value">{{ interval.label }}</option>
          </ng-container>
        </select>
      </div>
    </div>

    <div class="row mt-3 align-items-center">
      <div class="col-4">
        <span
          id="label-tray-icon"
          ngbTooltip="Disabling the tray icon also disables EPG notifications"
          >Enable tray icon</span
        >
      </div>
      <div class="col">
        <div class="form-check form-switch">
          <input
            [(ngModel)]="settings.enable_tray_icon"
            (ngModelChange)="updateSettings()"
            class="form-check-input"
            type="checkbox"
            aria-labelledby="label-tray-icon"
            title="Enable tray icon"
          />
        </div>
      </div>
    </div>
  </div>

  <!-- CONTENT FILTERS TAB -->
  <div *ngIf="activeTab === 'filters'">
    <div class="alert alert-info">
      Detected <strong>{{ tags.length }}</strong> common tags in your channels. Unchecking a tag
      will hide all channels containing that tag.
    </div>

    <div class="row">
      <div class="col-12">
        <table class="table table-dark table-hover">
          <thead>
            <tr>
              <th>Tag Name</th>
              <th>Channel Count</th>
              <th>Visible</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let tag of tags">
              <td>
                <span class="badge bg-secondary">{{ tag.name }}</span>
              </td>
              <td>{{ tag.count }}</td>
              <td>
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    [checked]="tag.hidden_count < tag.count"
                    (change)="toggleTag(tag, $event)"
                    title="Toggle visibility for channels with tag {{ tag.name }}"
                  />
                </div>
              </td>
            </tr>
            <tr *ngIf="tags.length === 0">
              <td colspan="3" class="text-center text-muted">
                No common tags detected. Try refreshing your sources.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <h2 class="mt-4 mb-4 text-center">Sources</h2>
  <ng-container *ngFor="let source of sources; let i = index">
    <div [ngClass]="{ 'mt-3': i != 0 }">
      <app-source-tile [source]="source"></app-source-tile>
    </div>
  </ng-container>

  <div class="mt-4 d-flex flex-wrap gap-3">
    <button
      [disabled]="memory.Loading"
      (click)="addSource()"
      class="btn btn-primary d-inline-flex align-items-center"
    >
      <span>Add source </span>
      <svg class="plus ms-1" fill="currentColor" viewBox="0 0 24 24">
        <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" />
      </svg>
    </button>
    <button
      [disabled]="memory.Loading"
      (click)="refreshAll()"
      class="btn btn-secondary d-inline-flex align-items-center"
    >
      Refresh all
      <svg class="refresh ms-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path
          fill="currentColor"
          d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"
        />
      </svg>
    </button>
    <button
      [disabled]="memory.Loading"
      (click)="clearHistory()"
      class="btn btn-secondary d-inline-flex align-items-center"
    >
      Clear history
      <svg class="history ms-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path
          fill="currentColor"
          d="M13.5,8H12V13L16.28,15.54L17,14.33L13.5,12.25V8M13,3A9,9 0 0,0 4,12H1L4.89,15.89L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3"
        />
      </svg>
    </button>
    <button
      ngbTooltip="Use this if an upgrade didn't fix a bug you're experiencing"
      class="btn btn-danger d-inline-flex align-items-center"
      [disabled]="memory.Loading"
      (click)="nuke()"
    >
      Delete everything
      <svg class="nuke ms-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path
          fill="currentColor"
          d="M14.04,12H10V11H5.5A3.5,3.5 0 0,1 2,7.5A3.5,3.5 0 0,1 5.5,4C6.53,4 7.45,4.44 8.09,5.15C8.5,3.35 10.08,2 12,2C13.92,2 15.5,3.35 15.91,5.15C16.55,4.44 17.47,4 18.5,4A3.5,3.5 0 0,1 22,7.5A3.5,3.5 0 0,1 18.5,11H14.04V12M10,16.9V15.76H5V13.76H19V15.76H14.04V16.92L20,19.08C20.58,19.29 21,19.84 21,20.5A1.5,1.5 0 0,1 19.5,22H4.5A1.5,1.5 0 0,1 3,20.5C3,19.84 3.42,19.29 4,19.08L10,16.9Z"
        />
      </svg>
    </button>
  </div>
</div>

<div class="author mt-5 mb-4">
  <p>
    <a href="https://github.com/Fredolx/open-tv/discussions/69" target="_blank" rel="noopener">
      Made by Frédéric Lachapelle with ❤️
      <br />Please consider donating to support future updates <br />Beats TV is currently not
      sustainable and needs your support
    </a>
  </p>
</div>
