<div
  id="tile-{{ id }}"
  placement="top"
  tabindex="0"
  (keyup.enter)="click()"
  [ngClass]="{
    playing: starting,
    faded: fade,
    'three-lines': threeLines,
    compact: compact,
    selected: selected,
  }"
  [ngbTooltip]="channel?.name"
  triggers="hover"
  (click)="click()"
  class="channel"
  (contextmenu)="onRightClick($event)"
>
  <div class="channel-content">
    <div class="image-container">
      <img
        (error)="showImage = false"
        class="channel-image"
        *ngIf="channel?.image && showImage"
        [src]="channel?.image"
        [alt]="channel?.name"
        loading="lazy"
      />
      <div class="image-placeholder" *ngIf="!channel?.image || !showImage">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M21,19V5c0-1.1-0.9-2-2-2H5c-1.1,0-2,0.9-2,2v14c0,1.1,0.9,2,2,2h14C20.1,21,21,20.1,21,19z M8.5,13.5l2.5,3l3.5-4.5l4.5,6H5L8.5,13.5z"
          />
        </svg>
      </div>
    </div>
    <div class="channel-info">
      <div class="channel-title" [title]="channel?.name">{{ channel?.name }}</div>
      <div class="channel-meta">
        <span class="channel-source">{{ getSourceName() }}</span>
        <div class="channel-badges">
          <span class="badge-live" *ngIf="channel?.media_type === mediaTypeEnum.livestream"
            >LIVE</span
          >
          <span class="badge-movie" *ngIf="channel?.media_type === mediaTypeEnum.movie">VOD</span>
          <span class="badge-series" *ngIf="channel?.media_type === mediaTypeEnum.serie"
            >SERIES</span
          >
          <span class="badge-rating" *ngIf="channel?.rating"
            ><i class="fa fa-star"></i> {{ channel?.rating | number: "1.1-1" }}</span
          >
          <span class="badge-year" *ngIf="channel?.release_date">{{
            channel?.release_date | slice: 0 : 4
          }}</span>
        </div>
      </div>
    </div>
    <div class="channel-actions">
      <svg
        *ngIf="channel?.tv_archive === true"
        fill="currentColor"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        class="action-icon archive-icon"
        title="Archive available"
      >
        <path
          d="M20 6H2V2H20V6M16.5 12H15V17L18.61 19.16L19.36 17.94L16.5 16.25V12M23 16C23 19.87 19.87 23 16 23C13.62 23 11.53 21.81 10.26 20H3V7H19V9.68C21.36 10.81 23 13.21 23 16M8 12H10.26C10.83 11.19 11.56 10.5 12.41 10H8.5C8.22 10 8 10.22 8 10.5V12M21 16C21 13.24 18.76 11 16 11S11 13.24 11 16 13.24 21 16 21 21 18.76 21 16Z"
        />
      </svg>
      <svg
        *ngIf="channel?.favorite"
        fill="currentColor"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        class="action-icon favorite-icon"
        title="Favorite"
      >
        <path
          d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
        />
      </svg>
    </div>
  </div>
  <div class="selection-indicator" *ngIf="selectionMode && selected">
    <svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z" />
    </svg>
  </div>
</div>

<div
  style="visibility: hidden; position: fixed"
  [style.left.px]="menuTopLeftPosition.x"
  [style.top.px]="menuTopLeftPosition.y"
  [matMenuTriggerFor]="rightMenu"
></div>

<mat-menu #rightMenu="matMenu">
  <ng-template matMenuContent let-item="item">
    <button [hidden]="viewMode != viewModeEnum.History" mat-menu-item (click)="removeFromHistory()">
      Remove
    </button>
    <button
      [hidden]="
        channel?.media_type == mediaTypeEnum.group ||
        channel?.media_type == mediaTypeEnum.season ||
        viewMode == viewModeEnum.History
      "
      mat-menu-item
      (click)="favorite()"
    >
      <ng-container *ngIf="alreadyExistsInFav">Unfavorite</ng-container>
      <ng-container *ngIf="!alreadyExistsInFav">Favorite</ng-container>
    </button>
    <button
      [hidden]="isCustom() || viewMode == viewModeEnum.History"
      mat-menu-item
      (click)="hide()"
    >
      <ng-container *ngIf="alreadyHidden">Unhide</ng-container>
      <ng-container *ngIf="!alreadyHidden">Hide</ng-container>
    </button>
    <button [hidden]="!isLivestream()" mat-menu-item (click)="record()">Record</button>
    <button [hidden]="!isMovie() || downloading" mat-menu-item (click)="downloadVod()">
      Download
    </button>
    <button [hidden]="!isMovie() || !downloading" mat-menu-item (click)="cancelDownload()">
      Cancel download
    </button>
    <button [hidden]="!showEPG()" mat-menu-item (click)="showEPGModal()">EPG</button>
    <button [hidden]="!isCustom()" mat-menu-item (click)="edit()">Edit</button>
    <button [hidden]="!isCustom()" mat-menu-item (click)="share()">Share</button>
    <button [hidden]="!isLivestream()" mat-menu-item (click)="openRestreamModal()">
      Re-stream
    </button>
    <button [hidden]="!isCustom()" mat-menu-item (click)="delete()">Delete</button>
  </ng-template>
</mat-menu>
